<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vermieterprofil â€“ Locorent</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --green: #2e7d32;
      --green-dark: #1b5e20;
      --bg: #f1f8e9;
      --white: #fff;
      --light: #f5f5f5;
      --radius: 12px;
      --shadow: rgba(0,0,0,0.1);
      --max-width: 1200px;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body { background: var(--bg); font-family:'Poppins',sans-serif; color:#333; }
    header {
      background: var(--green); color:var(--white);
      padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center;
    }
    header nav a {
      color:white; margin-left:1rem; text-decoration:none; font-weight:600;
    }
    header nav a:hover { border-bottom:2px solid var(--green-dark); }
    main { max-width:var(--max-width); margin:2rem auto; background:var(--white); border-radius:var(--radius); box-shadow:0 4px 12px var(--shadow); padding:2rem; }
    .profile-info { display:flex; flex-wrap:wrap; gap:2rem; }
    .profile-info .box { flex:1; border-radius:var(--radius); background:var(--light); padding:1rem; box-shadow:0 2px 8px var(--shadow); }
    .tabs { margin-top:2rem; display:flex; border-bottom:2px solid #ccc; }
    .tabs button {
      background:none; border:none; padding:1rem 2rem;
      cursor:pointer; font-weight:600;
    }
    .tabs button.active { border-bottom:4px solid var(--green); }
    .tab-content { margin-top:1rem; }
    .listing-card {
      background:var(--white); border-radius:10px; box-shadow:0 2px 8px var(--shadow);
      padding:1rem; margin-bottom:1rem;
    }
    .listing-card h3 { margin-bottom:.5rem; }
    .review { margin-bottom:1rem; padding:1rem; background:var(--light); border-radius:var(--radius); }
    footer { text-align:center; padding:1.5rem; background:var(--green); color:var(--white); margin-top:3rem; }
  </style>
</head>
<body>
  <header>
    <h1>Locorent</h1>
    <nav id="nav-links"></nav>
  </header>
  <main id="main-content">
    <div class="profile-info">
      <div class="box">
        <h2 id="profile-name">Name laden...</h2>
        <p id="profile-city">Ort laden...</p>
        <p id="profile-bio">Bio laden...</p>
        <p id="profile-rating"></p>
      </div>
    </div>
    <div class="tabs">
      <button data-tab="messages" class="active">Nachrichten</button>
      <button data-tab="listings">Inserate</button>
      <button data-tab="reviews">Bewertungen</button>
    </div>
    <div class="tab-content" id="tab-content">
      <p>Lade Nachrichtenâ€¦</p>
    </div>
  </main>
  <footer>Â© 2025 Locorent â€“ Mieten statt kaufen</footer>

  <script>
    const supabase = window.supabase.createClient('https://flnjalgqtkqycsaymmbd.supabase.co','[KEY]');
    let currentUser = null, ownerId = null;

    async function updateNav(){
      const { data:{session} } = await supabase.auth.getSession();
      const nav = document.getElementById('nav-links');
      if(session?.user){
        nav.innerHTML = `
         <a href="index.html">Start</a>
         <a href="profil.html">Mein Profil</a>
         <a href="nachrichten-inbox.html">ðŸ“¨ Nachrichten</a>
         <a href="favoriten.html">Meine Favoriten</a>
         <a href="inserate.html">Meine Inserate</a>
         <a href="#" onclick="logout()">Logout</a>`;
      } else {
        nav.innerHTML = `<a href="login.html">Einloggen</a><a href="register.html">Registrieren</a>`;
      }
    }

    async function logout(){
      await supabase.auth.signOut();
      location.href='login.html';
    }

    async function init(){
      const { data:{ user } } = await supabase.auth.getUser();
      currentUser = user || null;
      updateNav();

      const params = new URLSearchParams(location.search);
      ownerId = params.get('id');

      // Profil-Daten
      const { data:profile } = await supabase.from('profiles').select('name,city,bio').eq('id',ownerId).single();
      document.getElementById('profile-name').innerText = profile.name;
      document.getElementById('profile-city').innerText = profile.city;
      document.getElementById('profile-bio').innerText = profile.bio;

      setupTabs();
      loadTabContent('messages');
    }

    function setupTabs(){
      document.querySelectorAll('.tabs button').forEach(btn=>{
        btn.onclick = ()=> {
          document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          loadTabContent(btn.dataset.tab);
        };
      });
    }

    async function loadTabContent(tab){
      const c = document.getElementById('tab-content');
      c.innerHTML = '<p>Ladeâ€¦</p>';
      if(tab==='messages'){
        if(!currentUser) { c.innerHTML='<p>Bitte einloggen, um Nachrichten zu sehen.</p>'; return; }
        const { data:msgs } = await supabase.from('messages')
          .select('id,content,created_at')
          .eq('to_user', ownerId).order('created_at',{ascending:false});
        c.innerHTML = msgs.map(m=>`<div class="listing-card"><p><em>${m.created_at}</em><br>${m.content}</p></div>`).join('') || '<p>Keine Nachrichten.</p>';
      }
      else if(tab==='listings'){
        const { data:listings } = await supabase.from('listings')
          .select('id,title,price_per_day,description')
          .eq('user_id', ownerId).order('created_at',{ascending:false});
        c.innerHTML = listings.map(l=>
          `<div class="listing-card"><h3>${l.title}</h3><p>${l.price_per_day}â€¯â‚¬/Tag</p><p>${l.description}</p>
           <button onclick="location.href='mietobjekt.html?id=${l.id}'">Details ansehen</button></div>`).join('') || '<p>Keine Inserate.</p>';
      }
      else if(tab==='reviews'){
        // hier fiktive reviews-Tabelle
        const { data:reviews } = await supabase.from('reviews')
          .select('id,rating,comment,created_at').eq('for_user',ownerId).order('created_at',{ascending:false});
        c.innerHTML = reviews.map(r=>
          `<div class="review"><p><strong>${r.rating}â˜…</strong> â€“ ${r.created_at}</p><p>${r.comment}</p></div>`).join('') || '<p>Keine Bewertungen.</p>';
      }
    }

    init();
  </script>
</body>
</html>
